#! /bin/bash

## Might have trouble with symbolic links
cd $(dirname "${BASH_SOURCE[0]}")

## Read common configuration
. ./config-filelist

## Select the files to do
files="$( ls ../test | grep -v '^rac' | comm -23 - skips | sort | sed -e 'sx^x../test/x' )"

## Get any options
threads=3
if [ $# -gt 0 ]; then
  if [ "$1" = "-t" ]; then
    threads=$2
    shift
    shift
  fi
fi

## Do them
if [ $# -gt 0 ]; then
  ## Listed files
  . ./spawn "$@"
else
  ## One-off scripted tests
  for f in ../test/prefer1/test.sh ../test/nomodelfield/run ../test/nomodelmethod/run ; do
    echo Testing $f
    $f || echo $f FAILED;
  done
  ## All files to be tested
  . ./spawn $files
fi

